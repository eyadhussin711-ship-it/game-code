<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>Support System</title>
<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#0b132b;color:#fff}
.hidden{display:none}
.app{display:flex;height:100vh}
.sidebar{width:230px;background:#1c2541;padding:15px}
.sidebar h3{margin-top:0}
.sidebar button{width:100%;margin:6px 0;padding:10px;border:0;border-radius:8px;cursor:pointer}
.main{flex:1;padding:15px}
.header{display:flex;justify-content:space-between;align-items:center}
.list{background:#1c2541;border-radius:10px;padding:10px;margin-top:10px}
.item{padding:8px;border-bottom:1px solid #2b355a;cursor:pointer}
.item:last-child{border-bottom:0}
.chat{background:#1c2541;border-radius:10px;padding:10px;height:55vh;overflow:auto}
.msg{margin:6px 0}
.me{color:#ffd166}
.sup{color:#06d6a0}
input,select{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:0}
.send{display:flex;gap:6px}
.send input{flex:1}
.send button{padding:8px 12px;border:0;border-radius:6px;cursor:pointer}
.login{max-width:320px;margin:80px auto;background:#1c2541;padding:20px;border-radius:12px;text-align:center}
.badge{background:#ffd166;color:#000;padding:2px 8px;border-radius:12px}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login" id="login">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input id="name" placeholder="Ø§Ø³Ù…Ùƒ">
  <button onclick="loginClient()">Ø¯Ø®ÙˆÙ„ ÙƒØ¹Ù…ÙŠÙ„</button>
  <hr>
  <input id="scode" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¯Ø¹Ù…">
  <button onclick="loginSupport()">Ø¯Ø®ÙˆÙ„ ÙƒØ¯Ø¹Ù…</button>
</div>

<!-- APP -->
<div class="app hidden" id="app">
  <div class="sidebar">
    <h3 id="roleTitle"></h3>
    <button onclick="show('store')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>
    <button onclick="show('orders')">ğŸ“¦ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</button>
    <button onclick="show('complaints')">ğŸ§¾ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</button>
    <button onclick="show('support')" id="supportBtn">ğŸ§‘â€ğŸ’¼ Ø§Ù„Ø¯Ø¹Ù…</button>
    <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="main">
    <div class="header">
      <div>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ <b id="uname"></b></div>
      <span class="badge" id="badge"></span>
    </div>

    <!-- STORE -->
    <div id="store" class="list">
      <div class="item">60 UC</div>
      <div class="item">300 UC</div>
    </div>

    <!-- ORDERS -->
    <div id="orders" class="list hidden">
      Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª (ØªØ¬Ø±ÙŠØ¨ÙŠ)
    </div>

    <!-- COMPLAINTS -->
    <div id="complaints" class="hidden">
      <button onclick="newComplaint()">â• ÙØªØ­ Ø´ÙƒÙˆÙ‰</button>
      <div class="list" id="myComplaints"></div>
    </div>

    <!-- SUPPORT PANEL -->
    <div id="support" class="hidden">
      <h3>ÙƒÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</h3>
      <div class="list" id="allComplaints"></div>
    </div>

    <!-- CHAT -->
    <div id="chatBox" class="hidden">
      <h3 id="chatTitle"></h3>
      <div class="chat" id="chat"></div>
      <div class="send">
        <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
        <button onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </div>

  </div>
</div>

<script>
const SUPPORT_CODE="SUPPORT123";
let user="", role="client", currentRoom=null;

function loginClient(){
  user=document.getElementById('name').value.trim();
  if(!user) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
  role="client"; start();
}
function loginSupport(){
  if(document.getElementById('scode').value!==SUPPORT_CODE) return alert("ÙƒÙ„Ù…Ø© Ø³Ø± ØºÙ„Ø·");
  user="Ø§Ù„Ø¯Ø¹Ù…"; role="support"; start();
}
function start(){
  document.getElementById('login').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  document.getElementById('uname').innerText=user;
  document.getElementById('badge').innerText= role==="support"?"SUPPORT":"CLIENT";
  document.getElementById('roleTitle').innerText= role==="support"?"ğŸ§‘â€ğŸ’¼ Ø¯Ø¹Ù…":"ğŸ‘¤ Ø¹Ù…ÙŠÙ„";
  document.getElementById('supportBtn').style.display= role==="support"?"block":"none";
  show('store'); refreshLists(); setInterval(refreshChat,5000);
}
function logout(){ location.reload(); }

function show(id){
  ['store','orders','complaints','support','chatBox'].forEach(x=>document.getElementById(x).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function data(){ return JSON.parse(localStorage.getItem('complaints')||'[]'); }
function save(d){ localStorage.setItem('complaints',JSON.stringify(d)); }

function newComplaint(){
  const type=prompt("Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰:\n1 ØªØ£Ø®ÙŠØ±\n2 Ø§Ø³ØªÙØ³Ø§Ø±\n3 Ù…Ø´ÙƒÙ„Ø©");
  if(!type) return;
  const d=data();
  const id='c'+Date.now();
  d.push({id,owner:user,type,chat:[]});
  save(d); refreshLists(); openRoom(id);
}
function refreshLists(){
  const d=data();
  // my
  const my=d.filter(x=>x.owner===user);
  document.getElementById('myComplaints').innerHTML=my.map(x=>`<div class="item" onclick="openRoom('${x.id}')">${x.id}</div>`).join('')||'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
  // all
  if(role==="support"){
    document.getElementById('allComplaints').innerHTML=d.map(x=>`<div class="item" onclick="openRoom('${x.id}')">${x.id} - ${x.owner}</div>`).join('')||'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
  }
}
function openRoom(id){
  currentRoom=id; show('chatBox');
  document.getElementById('chatTitle').innerText="ØºØ±ÙØ© "+id;
  refreshChat();
}
function sendMsg(){
  if(!currentRoom) return;
  const txt=document.getElementById('msg').value.trim();
  if(!txt) return;
  const d=data(); const r=d.find(x=>x.id===currentRoom);
  r.chat.push({from:role,text:txt,time:Date.now()});
  save(d); document.getElementById('msg').value=""; refreshChat();
}
function refreshChat(){
  if(!currentRoom) return;
  const d=data(); const r=d.find(x=>x.id===currentRoom);
  if(!r) return;
  const box=document.getElementById('chat');
  box.innerHTML=r.chat.map(m=>`<div class="msg ${m.from==='support'?'sup':'me'}">${m.from==='support'?'Ø§Ù„Ø¯Ø¹Ù…':'Ø§Ù„Ø¹Ù…ÙŠÙ„'}: ${m.text}</div>`).join('');
  box.scrollTop=box.scrollHeight;
}
</script>
</body>
</html>
