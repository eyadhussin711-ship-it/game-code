<script>
const STAFF_CODE = "QUEEN-STAFF";
const DRINKS = ["ÿ¥ÿßŸä","ŸÇŸáŸàÿ©","ÿ®Ÿäÿ®ÿ≥Ÿä","ŸÖŸäÿßŸá"];

function doLogin(){
  const name = nameInput.value.trim();
  if(!name){ alert("ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖŸÉ"); return; }

  const role = (codeInput.value === STAFF_CODE) ? "staff" : "guest";
  localStorage.setItem("user", name);
  localStorage.setItem("role", role);
  startApp();
}

function startApp(){
  loginBox.style.display="none";
  app.style.display="block";

  if(localStorage.getItem("role")==="staff"){
    ordersBtn.style.display="block";
    newsForm.style.display="block";
  }
  renderRooms();
  renderMenu();
}

function showSection(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function renderRooms(){
  roomsList.innerHTML="";
  for(let i=1;i<=12;i++){
    roomsList.innerHTML += `<div class="item">ÿ∫ÿ±ŸÅÿ© ÿ±ŸÇŸÖ ${i}</div>`;
  }
}

function renderMenu(){
  menuList.innerHTML="";
  DRINKS.forEach(d=>{
    menuList.innerHTML += `
      <div class="item">
        ${d}
        <button class="smallBtn" onclick="makeOrder('${d}')">ÿ∑ŸÑÿ®</button>
      </div>`;
  });
}

function logout(){
  localStorage.clear();
  location.reload();
}

window.onload = ()=>{
  if(localStorage.getItem("user")){
    startApp();
  }
};
</script>

<!-- üî• Firebase (ŸÑÿßÿ≤ŸÖ ŸäŸÉŸàŸÜ ŸÑŸàÿ≠ÿØŸá) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBA2YeC6Mo8CZi7Ms5Gckhm4SWPmLgFNcE",
  authDomain: "queenhotel-5703c.firebaseapp.com",
  projectId: "queenhotel-5703c",
  storageBucket: "queenhotel-5703c.firebasestorage.app",
  messagingSenderId: "1024771547857",
  appId: "1:1024771547857:web:8dd74f752bf0a4b6999bf0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® */
window.makeOrder = async function(drink){
  let room = prompt("ÿßÿÆÿ™ÿ± ÿ±ŸÇŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ© ŸÖŸÜ 1 ÿ•ŸÑŸâ 12");
  room = Number(room);
  if(!room || room < 1 || room > 12){
    alert("ÿ±ŸÇŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿ∫ŸÑÿ∑");
    return;
  }

  await addDoc(collection(db,"orders"),{
    user: localStorage.getItem("user"),
    room,
    drink,
    time: serverTimestamp()
  });

  alert("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ‚úÖ");
};

/* ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ Live */
const ordersList = document.getElementById("ordersList");
onSnapshot(collection(db,"orders"), snap=>{
  if(!ordersList) return;
  ordersList.innerHTML="";
  snap.forEach(doc=>{
    const o = doc.data();
    ordersList.innerHTML += `
      <div class="item small">
        ${o.user} | ÿ∫ÿ±ŸÅÿ© ${o.room} | ${o.drink}
      </div>`;
  });
});
</script>
