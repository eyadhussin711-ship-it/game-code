<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>UC Store System</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{
  margin:0;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.hidden{display:none}

/* LOGIN */
#login{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  width:320px;
  background:rgba(255,255,255,.15);
  padding:25px;
  border-radius:16px;
  text-align:center;
}
.login-box input{
  width:100%;
  padding:12px;
  margin:8px 0;
  border:none;
  border-radius:10px;
}
.login-box button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:20px;
  background:#00f5ff;
  font-weight:bold;
  cursor:pointer;
}

/* APP */
#app{display:none;height:100vh}
.header{padding:10px;background:rgba(0,0,0,.3)}
.main{display:flex;height:calc(100vh - 50px)}
.sidebar{
  width:220px;
  background:rgba(0,0,0,.4);
  padding:10px;
}
.sidebar button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:12px;
  background:rgba(255,255,255,.15);
  color:#fff;
  cursor:pointer;
}
.sidebar button.active{
  background:#00f5ff;
  color:#000;
}

.content{flex:1;padding:15px}

/* STORE */
.card{
  background:rgba(255,255,255,.15);
  padding:15px;
  border-radius:12px;
  margin:10px 0;
}
.buy{
  margin-top:10px;
  padding:10px;
  width:100%;
  border:none;
  border-radius:20px;
  background:#ffd166;
  cursor:pointer;
}

/* USERS */
.user{
  padding:6px;
  cursor:pointer;
}
.user:hover{background:rgba(255,255,255,.15)}

/* CHAT */
.chat{
  background:rgba(0,0,0,.4);
  padding:10px;
  height:250px;
  overflow:auto;
  border-radius:10px;
}
.msg{margin:5px 0}
.me{color:#00f5ff}
.admin{color:#ffd166}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input id="username" placeholder="Ø§Ø³Ù…Ùƒ">
    <input id="code" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ†Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="header">
    Ø£Ù‡Ù„Ø§Ù‹ <span id="userName"></span>
  </div>

  <div class="main">
    <div class="sidebar">
      <button class="nav active" onclick="openSec('store',this)">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>
      <button class="nav" onclick="openSec('tickets',this)">ğŸ§¾ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</button>
      <button class="nav hidden" id="ownerBtn" onclick="openSec('owner',this)">ğŸ‘‘ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
      <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="content">

      <!-- STORE -->
      <div id="store" class="section">
        <div class="card">60 UC<button class="buy">Ø´Ø±Ø§Ø¡</button></div>
        <div class="card">300 UC<button class="buy">Ø´Ø±Ø§Ø¡</button></div>
        <div class="card">600 UC<button class="buy">Ø´Ø±Ø§Ø¡</button></div>
      </div>

      <!-- TICKETS -->
      <div id="tickets" class="section hidden">
        <input id="ticketText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø´ÙƒÙˆÙ‰">
        <button onclick="newTicket()">ÙØªØ­ Ø´ÙƒÙˆÙ‰</button>
        <div id="myTickets"></div>
      </div>

      <!-- OWNER -->
      <div id="owner" class="section hidden">
        <h3>ğŸ‘¥ Ø§Ù„Ø£Ø´Ø®Ø§Øµ</h3>
        <div id="usersList"></div>

        <div id="actions" class="hidden">
          <p id="selUser"></p>
          <button onclick="setRole('Admin')">ØªÙˆØ¸ÙŠÙ</button>
          <button onclick="setRole('Mod')">ØªØ±Ù‚ÙŠØ©</button>
          <button onclick="fire()">ÙØµÙ„</button>
          <button onclick="ban()">Ø­Ø¸Ø±</button>
        </div>

        <hr>
        <h3>ğŸ§¾ ÙƒÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ</h3>
        <div id="allTickets"></div>
      </div>

      <!-- CHAT -->
      <div id="chatBox" class="section hidden">
        <h3>Ø±ÙˆÙ… Ø§Ù„Ø´ÙƒÙˆÙ‰</h3>
        <div class="chat" id="chat"></div>
        <input id="chatMsg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
        <button onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>

    </div>
  </div>
</div>

<script>
const OWNER_CODE="OWNER-999";
let currentTicket=null;
let selectedUser=null;

/* LOGIN */
function login(){
  let u=username.value.trim();
  if(!u)return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
  let role=(code.value===OWNER_CODE)?"Owner":"Player";

  let users=JSON.parse(localStorage.users||"[]");
  if(!users.find(x=>x.name===u)){
    users.push({name:u,role,banned:false});
    localStorage.users=JSON.stringify(users);
  }

  let me=users.find(x=>x.name===u);
  if(me.banned)return alert("Ø£Ù†Øª Ù…Ø­Ø¸ÙˆØ±");

  localStorage.user=u;
  localStorage.role=me.role;
  start();
}

function start(){
  login.style.display="none";
  app.style.display="block";
  userName.innerText=localStorage.user;
  if(localStorage.role==="Owner"){
    ownerBtn.classList.remove("hidden");
    loadUsers();
    loadAllTickets();
  }
}

/* NAV */
function openSec(id,btn){
  document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.querySelectorAll(".nav").forEach(b=>b.classList.remove("active"));
  if(btn)btn.classList.add("active");
}

/* USERS */
function loadUsers(){
  let users=JSON.parse(localStorage.users||"[]");
  usersList.innerHTML="";
  users.forEach(u=>{
    usersList.innerHTML+=`<div class="user" onclick="selectUser('${u.name}')">${u.name} (${u.role})</div>`;
  });
}
function selectUser(n){
  selectedUser=n;
  selUser.innerText="Ø§Ù„Ù…Ø­Ø¯Ø¯: "+n;
  actions.classList.remove("hidden");
}
function setRole(r){
  update(u=>u.role=r);
}
function fire(){
  let users=JSON.parse(localStorage.users);
  users=users.filter(u=>u.name!==selectedUser);
  localStorage.users=JSON.stringify(users);
  loadUsers();
}
function ban(){
  update(u=>u.banned=true);
}
function update(fn){
  let users=JSON.parse(localStorage.users);
  users.forEach(u=>{if(u.name===selectedUser)fn(u)});
  localStorage.users=JSON.stringify(users);
  loadUsers();
}

/* TICKETS */
function newTicket(){
  let t=ticketText.value.trim();
  if(!t)return;
  let arr=JSON.parse(localStorage.tickets||"[]");
  arr.push({id:Date.now(),user:localStorage.user,msgs:[{from:"me",text:t}]});
  localStorage.tickets=JSON.stringify(arr);
  ticketText.value="";
  loadMyTickets();
}
function loadMyTickets(){
  let arr=JSON.parse(localStorage.tickets||"[]");
  myTickets.innerHTML="";
  arr.filter(t=>t.user===localStorage.user)
     .forEach(t=>myTickets.innerHTML+=`<div onclick="openChat(${t.id})">Ø´ÙƒÙˆÙ‰ #${t.id}</div>`);
}
function loadAllTickets(){
  let arr=JSON.parse(localStorage.tickets||"[]");
  allTickets.innerHTML="";
  arr.forEach(t=>allTickets.innerHTML+=`<div onclick="openChat(${t.id})">${t.user} - #${t.id}</div>`);
}
function openChat(id){
  currentTicket=id;
  openSec("chatBox");
  renderChat();
}
function renderChat(){
  let arr=JSON.parse(localStorage.tickets);
  let t=arr.find(x=>x.id===currentTicket);
  chat.innerHTML="";
  t.msgs.forEach(m=>chat.innerHTML+=`<div class="msg ${m.from}">${m.text}</div>`);
}
function sendMsg(){
  let txt=chatMsg.value.trim();
  if(!txt)return;
  let arr=JSON.parse(localStorage.tickets);
  let t=arr.find(x=>x.id===currentTicket);
  t.msgs.push({from:localStorage.role==="Owner"?"admin":"me",text:txt});
  localStorage.tickets=JSON.stringify(arr);
  chatMsg.value="";
  renderChat();
}

/* LOGOUT */
function logout(){
  localStorage.clear();
  location.reload();
}

window.onload=()=>localStorage.user&&start();
</script>

</body>
</html>
