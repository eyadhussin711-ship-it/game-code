<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queen Hotel</title>

<style>
*{box-sizing:border-box;font-family:Tahoma}
body{
  margin:0; min-height:100vh; color:#fff;
  background:linear-gradient(270deg,#000,#001a4d,#000);
  background-size:400% 400%;
  animation:bg 12s infinite;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.wrap{max-width:430px;margin:auto;padding:15px}
.box{background:rgba(0,0,40,.85);padding:18px;border-radius:16px}
h1{text-align:center;color:red;animation:glow 1.5s infinite alternate}
@keyframes glow{from{text-shadow:0 0 5px red}to{text-shadow:0 0 20px red}}
input,select,textarea,button{
  width:100%;padding:12px;margin:6px 0;border:none;border-radius:10px
}
button{background:#0a66ff;color:#fff;font-weight:bold}
.nav{display:flex;gap:5px;margin-bottom:10px}
.nav button{flex:1}
.section{display:none}
.section.active{display:block}
.item{background:#050b2a;padding:10px;border-radius:10px;margin:6px 0}
.small{font-size:12px;opacity:.85}
.badge{float:left;font-weight:bold}
.b1{color:#3cff00} .b2{color:#ffd000} .b3{color:#ff2a2a} .b4{color:#3aa0ff}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <div class="wrap">
    <div class="box">
      <h1>QUEEN</h1>
      <input id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ">
      <select id="roleSelect">
        <option value="client">Ø¹Ù…ÙŠÙ„</option>
        <option value="hotel">Ù…ÙˆØ¸Ù ÙÙ†Ø¯Ù‚</option>
        <option value="owner">Ø£ÙˆÙ†Ø±</option>
      </select>
      <input id="codeInput" placeholder="ÙƒÙˆØ¯ (Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†)">
      <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div class="wrap">

    <div class="nav">
      <button onclick="show('rooms')">ğŸ¨</button>
      <button onclick="show('orders')" id="ordersBtn" style="display:none">ğŸ“©</button>
      <button onclick="logout()">ğŸšª</button>
    </div>

    <!-- ROOMS -->
    <div id="rooms" class="section active">
      <h3>Ø§Ù„ØºØ±Ù</h3>
      <div id="roomsList"></div>
    </div>

    <!-- ORDERS -->
    <div id="orders" class="section">
      <h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØºØ±Ù</h3>
      <div id="ordersList"></div>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, onSnapshot,
  doc, getDoc, setDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBA2YeC6Mo8CZi7Ms5Gckhm4SWPmLgFNcE",
  authDomain: "queenhotel-5703c.firebaseapp.com",
  projectId: "queenhotel-5703c",
};
const appFB = initializeApp(firebaseConfig);
const db = getFirestore(appFB);

const OWNER="OWNER-QUEEN";
const HOTEL="HOTEL-QUEEN";

// ===== AUTH =====
window.login=()=>{
  const n=nameInput.value.trim();
  const r=roleSelect.value;
  const c=codeInput.value;
  if(!n) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
  if(r==="owner" && c!==OWNER) return alert("ÙƒÙˆØ¯ ØºÙ„Ø·");
  if(r==="hotel" && c!==HOTEL) return alert("ÙƒÙˆØ¯ ØºÙ„Ø·");
  localStorage.user=n; localStorage.role=r;
  loginBox.style.display="none";
  app.style.display="block";
  if(r!=="client") ordersBtn.style.display="block";
  loadRooms();
};

// ===== NAV =====
window.show=id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

// ===== ROOMS =====
async function loadRooms(){
  roomsList.innerHTML="";
  for(let i=1;i<=12;i++){
    const ref=doc(db,"rooms","room"+i);
    const snap=await getDoc(ref);
    let status=1; // default ÙØ§Ø¶ÙŠØ©
    if(snap.exists()) status=snap.data().status;
    else await setDoc(ref,{number:i,status:1});

    roomsList.innerHTML+=`
      <div class="item">
        <b>ØºØ±ÙØ© ${i}</b>
        <span class="badge b${status}">â— ${status}</span>
        <button onclick="openForm(${i})">Ø·Ù„Ø¨</button>
        <div id="form${i}" style="display:none">
          <input id="people${i}" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ">
          <input id="date${i}" placeholder="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„">
          <textarea id="note${i}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
          <button onclick="sendRoomOrder(${i})">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
      </div>`;
  }
}

window.openForm=i=>{
  document.getElementById("form"+i).style.display="block";
};

// ===== SEND ORDER =====
window.sendRoomOrder=async(room)=>{
  const people=document.getElementById("people"+room).value;
  const date=document.getElementById("date"+room).value;
  if(!people||!date) return alert("ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  await addDoc(collection(db,"orders"),{
    room, people, date,
    user:localStorage.user,
    time:new Date().toLocaleString()
  });
  alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ”");
};

// ===== ORDERS + STATUS CONTROLS =====
onSnapshot(collection(db,"orders"), snap=>{
  ordersList.innerHTML="";
  snap.forEach(d=>{
    const o=d.data();
    let controls="";
    if(localStorage.role!=="client"){
      controls=`
        <button onclick="setStatus(${o.room},1)">1 ÙØ§Ø¶ÙŠØ©</button>
        <button onclick="setStatus(${o.room},2)">2 Ø­Ø¬Ø²</button>
        <button onclick="setStatus(${o.room},3)">3 ØªØ£Ø¬ÙŠØ±</button>
        <button onclick="setStatus(${o.room},4)">4 ØµÙŠØ§Ù†Ø©</button>
      `;
    }
    ordersList.innerHTML+=`
      <div class="item small">
        ğŸ‘¤ ${o.user} | ğŸ¨ ØºØ±ÙØ© ${o.room}<br>
        ğŸ‘¥ ${o.people} | ğŸ“… ${o.date}<br>
        ${controls}
      </div>`;
  });
});

// ===== SET ROOM STATUS =====
window.setStatus=async(room,status)=>{
  await updateDoc(doc(db,"rooms","room"+room),{status});
  loadRooms();
};

// ===== LOGOUT =====
window.logout=()=>{
  localStorage.clear();
  location.reload();
};
</script>

</body>
</html>
