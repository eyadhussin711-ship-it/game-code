<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Support System Pro</title>
<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#0b132b;color:#fff}
.hidden{display:none}
.app{display:flex;height:100vh}
.sidebar{width:240px;background:#1c2541;padding:15px;animation:slide .4s}
@keyframes slide{from{margin-left:-240px}to{margin-left:0}}
.sidebar h3{margin:0 0 10px}
.sidebar button{width:100%;margin:5px 0;padding:10px;border:0;border-radius:8px;cursor:pointer}
.main{flex:1;padding:15px}
.header{display:flex;justify-content:space-between;align-items:center}
.list{background:#1c2541;border-radius:10px;padding:10px;margin-top:10px}
.item{padding:8px;border-bottom:1px solid #2b355a;cursor:pointer}
.item:last-child{border-bottom:0}
.chat{background:#1c2541;border-radius:10px;padding:10px;height:55vh;overflow:auto}
.msg{margin:6px 0}
.me{color:#ffd166}
.sup{color:#06d6a0}
input,select{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:0}
.send{display:flex;gap:6px}
.send input{flex:1}
.send button{padding:8px 12px;border:0;border-radius:6px;cursor:pointer}
.login{max-width:340px;margin:80px auto;background:#1c2541;padding:20px;border-radius:12px;text-align:center}
.badge{background:#ffd166;color:#000;padding:2px 8px;border-radius:12px}
.small{font-size:12px;opacity:.8}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login" id="login">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input id="email" placeholder="Gmail">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p class="small">Head Admin Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: head@admin.com</p>
</div>

<!-- APP -->
<div class="app hidden" id="app">
  <div class="sidebar">
    <h3 id="roleTitle"></h3>
    <button onclick="show('store')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>
    <button onclick="show('complaints')">ğŸ§¾ Ø´ÙƒØ§ÙˆÙŠÙŠ</button>
    <button onclick="show('support')" id="supportBtn">ğŸ§‘â€ğŸ’¼ Ø§Ù„Ø¯Ø¹Ù…</button>
    <button onclick="show('panel')" id="panelBtn">ğŸ‘‘ ØªØ­ÙƒÙ… Ø§Ù„Ø±ØªØ¨</button>
    <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="main">
    <div class="header">
      <div>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ <b id="uname"></b></div>
      <span class="badge" id="badge"></span>
    </div>

    <div id="store" class="list hidden">
      <div class="item">ğŸ’ 60 UC</div>
      <div class="item">ğŸ’ 300 UC</div>
    </div>

    <div id="complaints" class="hidden">
      <button onclick="newComplaint()">â• ÙØªØ­ Ø´ÙƒÙˆÙ‰</button>
      <div class="list" id="myComplaints"></div>
    </div>

    <div id="support" class="hidden">
      <h3>Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
      <div class="list" id="supportComplaints"></div>
    </div>

    <div id="panel" class="hidden">
      <h3>Ù„ÙˆØ­Ø© Head Admin</h3>
      <div class="list" id="usersPanel"></div>
    </div>

    <div id="chatBox" class="hidden">
      <h3 id="chatTitle"></h3>
      <div class="chat" id="chat"></div>
      <div class="send">
        <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
        <button onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </div>
  </div>
</div>

<script>
let currentUser=null,currentRoom=null;

function users(){return JSON.parse(localStorage.getItem("users")||"[]")}
function saveUsers(u){localStorage.setItem("users",JSON.stringify(u))}
function complaints(){return JSON.parse(localStorage.getItem("complaints")||"[]")}
function saveComplaints(c){localStorage.setItem("complaints",JSON.stringify(c))}

function login(){
  const email=document.getElementById("email").value.trim();
  if(!email) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„");

  let u=users();
  let user=u.find(x=>x.email===email);
  if(!user){
    user={email,role:email==="head@admin.com"?"head":"client",bannedSupport:false};
    u.push(user); saveUsers(u);
  }
  currentUser=user;
  start();
}

function start(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  document.getElementById("uname").innerText=currentUser.email;
  document.getElementById("badge").innerText=currentUser.role.toUpperCase();
  document.getElementById("roleTitle").innerText="ğŸ‘¤ "+currentUser.role;
  document.getElementById("supportBtn").style.display=
    ["helper","moderator","admin","head"].includes(currentUser.role)?"block":"none";
  document.getElementById("panelBtn").style.display=
    currentUser.role==="head"?"block":"none";
  refreshAll();
  setInterval(refreshChat,5000);
}

function logout(){location.reload()}
function show(id){
  ["store","complaints","support","panel","chatBox"].forEach(x=>document.getElementById(x).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function newComplaint(){
  const type=prompt("Ù†ÙˆØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰:\n1 Ø§Ø³ØªÙØ³Ø§Ø±\n2 ØªØ£Ø®ÙŠØ±\n3 Ù…Ø´ÙƒÙ„Ø©");
  if(!type) return;
  let c=complaints();
  const id="C"+Date.now();
  c.push({id,owner:currentUser.email,type,chat:[]});
  saveComplaints(c); refreshAll(); openRoom(id);
}

function refreshAll(){
  const c=complaints();
  document.getElementById("myComplaints").innerHTML=
    c.filter(x=>x.owner===currentUser.email)
    .map(x=>`<div class="item" onclick="openRoom('${x.id}')">${x.id}</div>`).join("")||"Ù„Ø§ ÙŠÙˆØ¬Ø¯";

  if(["helper","moderator","admin","head"].includes(currentUser.role)){
    document.getElementById("supportComplaints").innerHTML=
      c.filter(x=>allowType(x.type))
      .map(x=>`<div class="item" onclick="openRoom('${x.id}')">${x.id} - ${x.owner}</div>`).join("")||"Ù„Ø§ ÙŠÙˆØ¬Ø¯";
  }

  if(currentUser.role==="head"){
    let u=users();
    document.getElementById("usersPanel").innerHTML=
      u.map(x=>`
      <div class="item">
        ${x.email} (${x.role})
        ${x.role==="client"?`<button onclick="hire('${x.email}','helper')">ØªÙˆØ¸ÙŠÙ</button>`:""}
        ${x.role!=="head"&&x.role!=="client"?`<button onclick="fire('${x.email}')">ÙØµÙ„</button>`:""}
      </div>`).join("");
  }
}

function allowType(t){
  if(currentUser.role==="helper") return t=="1";
  if(currentUser.role==="moderator") return t=="1"||t=="2";
  return true;
}

function hire(email,role){
  let u=users(); let x=u.find(a=>a.email===email);
  if(x.bannedSupport) return alert("Ù…ÙØµÙˆÙ„ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§");
  x.role=role; saveUsers(u); refreshAll();
}

function fire(email){
  let u=users(); let x=u.find(a=>a.email===email);
  x.role="client"; x.bannedSupport=true;
  saveUsers(u); refreshAll();
}

function openRoom(id){
  currentRoom=id; show("chatBox");
  document.getElementById("chatTitle").innerText="ØºØ±ÙØ© "+id;
  refreshChat();
}

function sendMsg(){
  if(!currentRoom) return;
  let txt=document.getElementById("msg").value.trim();
  if(!txt) return;
  let c=complaints(); let r=c.find(x=>x.id===currentRoom);
  r.chat.push({from:currentUser.role==="client"?"client":"support",text:txt});
  saveComplaints(c); document.getElementById("msg").value=""; refreshChat();
}

function refreshChat(){
  if(!currentRoom) return;
  let c=complaints(); let r=c.find(x=>x.id===currentRoom);
  let box=document.getElementById("chat");
  box.innerHTML=r.chat.map(m=>`<div class="msg ${m.from==="client"?"me":"sup"}">${m.from}: ${m.text}</div>`).join("");
  box.scrollTop=box.scrollHeight;
}
</script>
</body>
</html>
